<?xml version="1.0" encoding="UTF-8"?>
<!-- This document was created with Syntext Serna Free. -->
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<section id="JCR.WebDAV" role="NotInToc">
  <title>WebDAV</title>

    <para>The WebDAV protocol enables you to use the third party tools to
    communicate with hierarchical content servers via HTTP. It is possible to
    add and remove documents or a set of documents from a path on the server.
    DeltaV is an extension of the WebDav protocol that allows managing
    document versioning. Locking guarantees protection against multiple access
    when writing resources. The ordering support allows changing the position
    of the resource in the list and sorts the directory to make the directory tree viewed conveniently.
    The fulltext search makes it easy to find the
    necessary documents. You can search by using two languages: SQL and
    XPATH.</para>

    <para>In JCR, you plug in the WebDAV layer on the top of your JCR implementation, based on the code taken
    from the extension modules of the reference implementation, so it is possible to browse a workspace using
    the third party tools (it can be Windows folders or Mac ones as well as a
    Java WebDAV client, such as DAVExplorer or IE using <menuchoice><guimenu>File</guimenu> <guimenuitem>Open as a Web
    Folder</guimenuitem></menuchoice>).</para>

    <para>Now WebDav is an extension of the REST service. To get the WebDav
    server ready, you must deploy the REST application. Then, you can access
    any workspaces of your repository by using the following URL:</para>
	<itemizedlist>
				<listitem>
					<para><uri>http://host:port/portal/rest/private/jcr/{RepositoryName}/{WorkspaceName}/{Path}</uri></para>
		</listitem>
	</itemizedlist>

  <para>For example, when accessing the WebDAV server with the URL<uri>
    http://localhost:8080/portal/rest/jcr/repository/collaboration</uri>, you will be asked to enter your login
    and password. Those will then be checked by using the organization service
    that can be implemented thanks to an InMemory (dummy) module or a DB
    module or an LDAP one and the JCR user session will be created with the
    correct JCR Credentials.
  </para>

    <note>
      <para>If you try the "in ECM" option, add "@ecm" to the user's password.
      Alternatively, you may modify jaas.conf by adding the <emphasis
      role="bold">domain=ecm</emphasis> option as follows:</para>
		<programlisting>exo-domain {
			 org.exoplatform.services.security.jaas.BasicLoginModule required domain=ecm;
		};</programlisting>
    </note>

    <para>
        <emphasis role="bold">Related documents</emphasis>
    </para>

    <itemizedlist>
        <listitem>
            <para>
                <link linkend="JCR.LinkProducerService">Link Producer</link>
            </para>
        </listitem>
    </itemizedlist>

  <section id="JCR.WebDAV.Configuration">
    <title>Configuration</title>
    <para>The following code snippet represents the configuration of the WebDAV component.</para>
    <programlisting language="xml">&lt;component&gt;
  &lt;key&gt;org.exoplatform.services.jcr.webdav.WebDavServiceImpl&lt;/key&gt;
  &lt;type&gt;org.exoplatform.services.jcr.webdav.WebDavServiceImpl&lt;/type&gt;
  &lt;init-params&gt;

    &lt;!-- this parameter indicates the default login and password values
         used as credentials for accessing the repository --&gt;
    &lt;!-- value-param&gt;
      &lt;name&gt;default-identity&lt;/name&gt;
      &lt;value&gt;admin:admin&lt;/value&gt;    
    &lt;/value-param --&gt;

    &lt;!-- this is the value of WWW-Authenticate header --&gt;
    &lt;value-param&gt;
      &lt;name&gt;auth-header&lt;/name&gt;
      &lt;value&gt;Basic realm="eXo-Platform Webdav Server 1.6.1"&lt;/value&gt;
    &lt;/value-param&gt;

    &lt;!-- default node type which is used for the creation of collections --&gt;
    &lt;value-param&gt;
      &lt;name&gt;def-folder-node-type&lt;/name&gt;
      &lt;value&gt;nt:folder&lt;/value&gt;
    &lt;/value-param&gt;

    &lt;!-- default node type which is used for the creation of files --&gt;
    &lt;value-param&gt;
      &lt;name&gt;def-file-node-type&lt;/name&gt;
      &lt;value&gt;nt:file&lt;/value&gt;
    &lt;/value-param&gt;

    &lt;!-- if MimeTypeResolver can't find the required mime type, 
         which conforms with the file extension, and the mimeType header is absent
         in the HTTP request header, this parameter is used 
         as the default mime type--&gt;
    &lt;value-param&gt;
      &lt;name&gt;def-file-mimetype&lt;/name&gt;
      &lt;value&gt;application/octet-stream&lt;/value&gt;
    &lt;/value-param&gt;

    &lt;!-- This parameter indicates one of the three cases when you update the content of the resource by PUT command.
         In case of "create-version", PUT command creates the new version of the resource if this resource exists.
         In case of "replace" - if the resource exists, PUT command updates the content of the resource and its last modification date.
         In case of "add", the PUT command tries to create the new resource with the same name (if the parent node allows same-name siblings).--&gt;

    &lt;value-param&gt;
      &lt;name&gt;update-policy&lt;/name&gt;
      &lt;value&gt;create-version&lt;/value&gt;
      &lt;!--value&gt;replace&lt;/value --&gt;
      &lt;!-- value&gt;add&lt;/value --&gt;
    &lt;/value-param&gt;

    &lt;!--
        This parameter determines how service responds to a method that attempts to modify file content.
        In case of "checkout-checkin" value, when a modification request is applied to a checked-in version-controlled resource, the request is automatically preceded by a checkout and followed by a checkin operation.
        In case of "checkout" value, when a modification request is applied to a checked-in version-controlled resource, the request is automatically preceded by a checkout operation.
    --&gt;         
    &lt;value-param&gt;
      &lt;name&gt;auto-version&lt;/name&gt;
      &lt;value&gt;checkout-checkin&lt;/value&gt;
      &lt;!--value&gt;checkout&lt;/value --&gt;
    &lt;/value-param&gt;

    &lt;!--
        This parameter is responsible for managing Cache-Control header value which will be returned to the client.
        You can use patterns like "text/*", "image/*" or wildcard to define the type of content.
    --&gt;  
    &lt;value-param&gt;
      &lt;name&gt;cache-control&lt;/name&gt;
      &lt;value&gt;text/xml,text/html:max-age=3600;image/png,image/jpg:max-age=1800;*/*:no-cache;&lt;/value&gt;
    &lt;/value-param&gt;
    
    &lt;!--
        This parameter determines the absolute path to the folder icon file, which is shown
        during WebDAV view of the contents
    --&gt;
    &lt;value-param&gt;
      &lt;name&gt;folder-icon-path&lt;/name&gt;
      &lt;value&gt;/absolute/path/to/file&lt;/value&gt;
    &lt;/value-param&gt;

    &lt;!-- 
        This parameter is responsible for untrusted user agents definition.
        Content-type headers of listed here user agents should be
        ignored and MimeTypeResolver should be explicitly used instead 
    --&gt;
    &lt;values-param&gt;
      &lt;name&gt;untrusted-user-agents&lt;/name&gt;
      &lt;value&gt;Microsoft Office Core Storage Infrastructure/1.0&lt;/value&gt;
    &lt;/values-param&gt;

  &lt;/init-params&gt;
&lt;/component&gt;</programlisting>
  </section>

  <section id="JCR.WebDAV.Examples">
    <title>Examples</title>

    <para>At present, the JCR WebDav server is tested by using MS Internet
    Explorer, <ulink url="http://www.ics.uci.edu/~webdav">Dav
    Explorer</ulink>, <ulink
    url="http://www.blackboard.com/Platforms/Learn/Products/Blackboard-Learn/Blackboard-Xythos/Xythos-Drive.aspx">Xythos
    Drive</ulink>, Microsoft Office 2003 (as client), and Ubuntu Linux.</para>

	<itemizedlist>
    <listitem>
      <para xml:id="JCR.WebDAV.Screenshots.MSInternetExplorer"><emphasis role="bold">MS Internet Explorer</emphasis>: Click <menuchoice><guimenu>File</guimenu><guisubmenu>eXo JCR WebDav </guisubmenu></menuchoice>.</para>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/protocols/webdav_explorer.jpg" />
        </imageobject>
      </mediaobject>
	</listitem>
   

    <listitem>
      <para xml:id="JCR.WebDAV.Screenshots.DavExplorer"><emphasis role="bold">Dav Explorer</emphasis></para>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/protocols/webdav_davexplorer.jpg" />
        </imageobject>
      </mediaobject>
    </listitem>

    <listitem>
      <para xml:id="JCR.WebDAV.Screenshots.XythosDrive"><emphasis role="bold">Xythos Drive</emphasis></para>

      <mediaobject>
        <imageobject>
          <imagedata fileref="images/protocols/webdav_xythosdrive.jpg" />
        </imageobject>
      </mediaobject>
    </listitem>

    <listitem>
      <para xml:id="JCR.WebDAV.Screenshots.MicrosoftOffice2003"><emphasis role="bold">Microsoft Office 2003</emphasis> (as client): Select <menuchoice><guimenu>File</guimenu><guisubmenu>Open</guisubmenu></menuchoice> with typing http://... href in the file name box.</para>
      <mediaobject>
        <imageobject>
          <imagedata fileref="images/protocols/webdav_msoffice2003.jpg" />
        </imageobject>
      </mediaobject>
    </listitem>

    <listitem>
      <para xml:id="JCR.WebDAV.Screenshots.UbuntuLinux"><emphasis role="bold">Ubuntu Linux</emphasis></para>
      <mediaobject>
        <imageobject>
          <imagedata fileref="images/protocols/webdav_ubuntulinux.jpg" />
        </imageobject>
      </mediaobject>
    </listitem>
	</itemizedlist>
  </section>

  <section id="JCR.WebDAV.ComparisonTableOfWebDavAndJCRCommands">
    <title>WebDav and JCR commands</title>

    <table>
      <title></title>

      <tgroup cols="2">
        <thead>
          <row>
            <entry>WebDav</entry>

            <entry>JCR</entry>
          </row>
        </thead>

        <tbody>
          <row>
            <entry><command>COPY</command></entry>

            <entry><command>Workspace.copy(...)</command></entry>
          </row>

          <row>
            <entry><command>DELETE</command></entry>

            <entry><command>Node.remove()</command></entry>
          </row>

          <row>
            <entry><command>GET</command></entry>

            <entry><command>Node.getProperty(...); Property.getValue()</command></entry>
          </row>

          <row>
            <entry><command>HEAD</command></entry>

            <entry><command>Node.getProperty(...); Property.getLength()</command></entry>
          </row>

          <row>
            <entry><command>MKCOL</command></entry>

            <entry><command>Node.addNode(...)</command></entry>
          </row>

          <row>
            <entry><command>MOVE</command></entry>

            <entry><command>Session.move(...) or Workspace.move(...)</command></entry>
          </row>

          <row>
            <entry><command>PROPFIND</command></entry>

            <entry><command>Session.getNode(...); Node.getNode(...);
            Node.getNodes(...); Node.getProperties()</command></entry>
          </row>

          <row>
            <entry><command>PROPPATCH</command></entry>

            <entry><command>Node.setProperty(...);
            Node.getProperty(...).remove()</command></entry>
          </row>

          <row>
            <entry><command>PUT</command></entry>

            <entry><command>Node.addNode("node","nt:file");
            Node.setProperty("jcr:data", "data")</command></entry>
          </row>

          <row>
            <entry><command>CHECKIN</command></entry>

            <entry><command>Node.checkin()</command></entry>
          </row>

          <row>
            <entry><command>CHECKOUT</command></entry>

            <entry><command>Node.checkout()</command></entry>
          </row>

          <row>
            <entry><command>REPORT</command></entry>

            <entry><command>Node.getVersionHistory(); VersionHistory.getAllVersions();
            Version.getProperties()</command></entry>
          </row>

          <row>
            <entry><command>RESTORE</command></entry>

            <entry><command>Node.restore(...)</command></entry>
          </row>

          <row>
            <entry><command>UNCHECKOUT</command></entry>

            <entry><command>Node.restore(...)</command></entry>
          </row>

          <row>
            <entry><command>VERSION-CONTROL</command></entry>

            <entry><command>Node.addMixin("mix:versionable")</command></entry>
          </row>

          <row>
            <entry><command>LOCK</command></entry>

            <entry><command>Node.lock(...)</command></entry>
          </row>

          <row>
            <entry><command>UNLOCK</command></entry>

            <entry><command>Node.unlock()</command></entry>
          </row>

          <row>
            <entry><command>ORDERPATCH</command></entry>

            <entry><command>Node.orderBefore(...)</command></entry>
          </row>

          <row>
            <entry><command>SEARCH</command></entry>

            <entry><command>Workspace.getQueryManager(); QueryManager.createQuery();
            Query.execute()</command></entry>
          </row>
        </tbody>
      </tgroup>
    </table>
  </section>

  <section id="JCR.WebDAV.Restrictions">
    <title>Restrictions</title>

    <para>There are some restrictions for WebDAV in different Operating systems.</para>
	<citetitle>
      <para xml:id="JCR.WebDAV.Restrictions.Windows7"><emphasis role="bold">Windows 7</emphasis></para>
	</citetitle>
      <para>When you try to set up a web folder by "adding a network location"
      or "mapping a network drive" through My Computer, you can get an error
      message saying that either "<emphasis>The folder you entered does not appear to be
      valid. Please choose another</emphasis>" or "<emphasis>Windows cannot access… Check the
      spelling of the name. Otherwise, there might be…</emphasis>". These errors may
      appear when you are using SSL or non-SSL.</para>
	  <para>To fix this problem, do the following steps:</para>
	  <procedure>
        <step>
			<para>Go to <emphasis role="bold">Windows Registry Editor</emphasis>. </para>
        </step>
        <step>
          <para>Find a key: <emphasis role="bold">\HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlset\services\WebClient\Parameters\BasicAuthLevel</emphasis>.
          </para>
        </step>
        <step>
          <para>Change the value to 2.</para>
        </step>
	  </procedure>
	
	  <citetitle>
		<para xml:id="JCR.WebDAV.Restrictions.MicrosoftOffice2010"><emphasis role="bold">Microsoft Office 2010</emphasis></para>
	  </citetitle>

    <para>If you have Microsoft Office 2010 or Microsoft Office 2007 applications installed on a client computer, try to
      access an Office file that is stored on a web server that is configured for Basic authentication from the client
      computer. The connection
      between your computer and the web server does not use Secure Sockets
      Layer (SSL). When you try to open or to download the file, you
      experience the following symptoms:
      <itemizedlist>
          <listitem>
            <para>The Office file does not open or download.</para>
          </listitem>

          <listitem>
            <para>You do not receive a Basic authentication password prompt
            when you try to open or to download the file.</para>
          </listitem>

          <listitem>
            <para>You do not receive an error message when you try to open the
            file. The associated Office application starts. However, the
            selected file does not open.</para>
          </listitem>
        </itemizedlist></para>
      <para>To enable the Basic authentication on the client computer, do as follows:</para>
	<procedure>
        <step>
          <para>Click <emphasis role="bold">Start</emphasis>, type <emphasis role="bold">regedit</emphasis> in the <emphasis role="bold">Start Search</emphasis> box, and then
          press <emphasis role="bold">Enter</emphasis>.</para>
        </step>
        <step>
          <para>Locate and then click the following registry subkey:</para>
          <para>
          <emphasis role="bold">HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\Common\Internet</emphasis></para>
        </step>
        <step>
          <para>On the <emphasis role="bold">Edit</emphasis> menu, point to <emphasis role="bold">New</emphasis>, and then click <emphasis role="bold">DWORD
          Value</emphasis>.</para>
        </step>
        <step>
          <para>Type <emphasis role="bold">BasicAuthLevel</emphasis>, and then press <emphasis role="bold">Enter</emphasis>. </para>
        </step>
        <step>
          <para>Right-click <emphasis role="bold">BasicAuthLevel</emphasis>, and then click <emphasis role="bold">Modify</emphasis>. </para>
        </step>
        <step>
          <para>In the <emphasis role="bold">Value</emphasis> data box, type 2, and then click <emphasis role="bold">OK</emphasis>. </para>
        </step>
	 </procedure>
  </section>
  <xi:include href="faq-webdav.xml" xmlns:xi="http://www.w3.org/2001/XInclude"/>
</section>