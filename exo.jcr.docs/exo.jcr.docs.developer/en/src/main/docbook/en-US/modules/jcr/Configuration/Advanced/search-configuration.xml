<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<section id="JCR.SearchConfiguration" role="NotInToc">
  <title>Search configuration</title>
  <para>Search is an important function in JCR, so it is very necessary for you to know how to configure the JCR Search tool.
	Before going deeper into the JCR Search tool, you need to learn about the <filename>.xml</filename> configuration file and its parameters as follows.</para>

<para id="JCR.SearchConfiguration.XMLConfig">
    <citetitle><emphasis role="bold">XML Configuration</emphasis></citetitle>
  </para>  
    <para>This is the JCR index configuration which you can find in: <filename>.../portal/WEB-INF/conf/jcr/repository-configuration.xml</filename>.</para>

<programlisting language="xml">&lt;repository-service default-repository="db1"&gt;
  &lt;repositories&gt;
    &lt;repository name="db1" system-workspace="ws" default-workspace="ws"&gt;
       ....
      &lt;workspaces&gt;
        &lt;workspace name="ws"&gt;
       ....
          &lt;query-handler class="org.exoplatform.services.jcr.impl.core.query.lucene.SearchIndex"&gt;
            &lt;properties&gt;
              &lt;property name="index-dir" value="${java.io.tmpdir}/temp/index/db1/ws" /&gt;
              &lt;property name="synonymprovider-class" value="org.exoplatform.services.jcr.impl.core.query.lucene.PropertiesSynonymProvider" /&gt;
              &lt;property name="synonymprovider-config-path" value="/synonyms.properties" /&gt;
              &lt;property name="indexing-configuration-path" value="/indexing-configuration.xml" /&gt;
              &lt;property name="query-class" value="org.exoplatform.services.jcr.impl.core.query.QueryImpl" /&gt;
            &lt;/properties&gt;
          &lt;/query-handler&gt;
        ... 
        &lt;/workspace&gt;
     &lt;/workspaces&gt;
    &lt;/repository&gt;        
  &lt;/repositories&gt;
&lt;/repository-service&gt;</programlisting>


  <para id="JCR.SearchConfiguration.Config_Parameters">
      <citetitle><emphasis role="bold">Configuration parameters</emphasis></citetitle>
  </para>
    <para>
    Followings are parameters of JCR index configuration:
    </para>
    <table>
      <title></title>

      <tgroup cols="3">
        <thead>
          <row>
            <entry>Parameter</entry>

            <entry>Default</entry>

            <entry>Description</entry>

          </row>
        </thead>

        <tbody>
          <row>
            <entry><parameter>index-dir</parameter></entry>

            <entry>none</entry>

            <entry>The location of the index directory. This parameter is
            mandatory.</entry>

          </row>

          <row>
            <entry><parameter>use-compoundfile</parameter></entry>

            <entry>true</entry>

            <entry>Advise Lucene to use compound files for the index files.</entry>

          </row>

          <row>
            <entry><parameter>min-merge-docs</parameter></entry>

            <entry>100</entry>

            <entry>Minimum number of nodes in an index until segments are merged.</entry>


          </row>

          <row>
            <entry><parameter>volatile-idle-time</parameter></entry>

            <entry>3</entry>

            <entry>Idle time in seconds until the volatile index part is moved
            to a persistent index even though minMergeDocs is not reached.</entry>

          </row>

          <row>
            <entry><parameter>max-merge-docs</parameter></entry>

            <entry>Integer.MAX_VALUE</entry>

            <entry>Maximum number of nodes in segments that will be merged.
            </entry>

          </row>

          <row>
            <entry><parameter>merge-factor</parameter></entry>

            <entry>10</entry>

            <entry>Determine how often segment indices are merged.</entry>

          </row>

          <row>
            <entry><parameter>max-field-length</parameter></entry>

            <entry>10000</entry>

            <entry>The number of words that are fulltext indexed at most per
            property.</entry>

          </row>

          <row>
            <entry><parameter>cache-size</parameter></entry>

            <entry>1000</entry>

            <entry>Size of the document number cache. This cache maps uuids to Lucene document numbers.</entry>

          </row>

          <row>
            <entry><parameter>force-consistencycheck</parameter></entry>

            <entry>false</entry>

            <entry>Run a consistency check on every startup. If false, a
            consistency check is only performed when the search index detects a prior forced shutdown.</entry>

          </row>

          <row>
            <entry><parameter>auto-repair</parameter></entry>

            <entry>true</entry>

            <entry>Errors detected by a consistency check are automatically repaired. If false, errors are only written to the log.</entry>

          </row>

          <row>
            <entry><parameter>query-class</parameter></entry>

            <entry>QueryImpl</entry>

            <entry>Class name that implements the <parameter>javax.jcr.query.Query</parameter> interface. This class must also extend from the <parameter>org.exoplatform.services.jcr.impl.core.query.AbstractQueryImpl</parameter> class.</entry>

          </row>

          <row>
            <entry><parameter>document-order</parameter></entry>

            <entry>true</entry>

            <entry>If 'true' is set and the query does not contain an 'order by'
            clause, result nodes will be in 'document order'. For better
            performance when queries return a lot of nodes, set this parameter to
            'false'.</entry>

          </row>

          <row>
            <entry><parameter>result-fetch-size</parameter></entry>

            <entry>Integer.MAX_VALUE</entry>

            <entry>The number of results when a query is executed. The default
            value is <parameter>Integer.MAX_VALUE</parameter>.</entry>

          </row>

          <row>
            <entry><parameter>excerptprovider-class</parameter></entry>

            <entry>DefaultXMLExcerpt</entry>

            <entry>The name of the class that implements
            <parameter>org.exoplatform.services.jcr.impl.core.query.lucene.ExcerptProvider</parameter>
            and should be used for the <parameter>rep:excerpt()</parameter> function in a
            query.</entry>

          </row>

          <row>
            <entry><parameter>support-highlighting</parameter></entry>

            <entry>false</entry>

            <entry>If set to true additional information is stored in the
            index to support highlighting using the <parameter>rep:excerpt()</parameter> function.</entry>

          </row>

          <row>
            <entry><parameter>synonymprovider-class</parameter></entry>

            <entry>none</entry>

            <entry>The name of a class that implements
            <parameter>org.exoplatform.services.jcr.impl.core.query.lucene.SynonymProvider</parameter>.
            The default value is null (not set).</entry>

          </row>

          <row>
            <entry><parameter>synonymprovider-config-path</parameter></entry>

            <entry>none</entry>

            <entry>The path to the synonym provider configuration file. This
            path is interpreted relatively to the path parameter. If there is a
            path element inside the <parameter>SearchIndex</parameter> element, then this path is
            interpreted and relative to the root path of the path. Whether
            this parameter is mandatory or not, it depends on the synonym
            provider implementation. The default value is null.</entry>

          </row>

          <row>
            <entry><parameter>indexing-configuration-path</parameter></entry>

            <entry>none</entry>

            <entry>The path to the indexing configuration file.</entry>

          </row>

          <row>
            <entry><parameter>indexing-configuration-class</parameter></entry>

            <entry>IndexingConfigurationImpl</entry>

            <entry>The name of the class that implements <parameter>org.exoplatform.services.jcr.impl.core.query.lucene.IndexingConfiguration</parameter>.</entry>

          </row>

          <row>
            <entry><parameter>force-consistencycheck</parameter></entry>

            <entry>false</entry>

            <entry>If "true" is set, a consistency check is performed,
            depending on the <parameter>forceConsistencyCheck</parameter> parameter. If setting to
            false, no consistency check is performed on startup, even if a redo log had been applied.</entry>

          </row>

          <row>
            <entry><parameter>spellchecker-class</parameter></entry>

            <entry>none</entry>

            <entry>The name of a class that implements <parameter>org.exoplatform.services.jcr.impl.core.query.lucene.SpellChecker</parameter>.</entry>

          </row>

          <row>
            <entry><parameter>spellchecker-more-popular</parameter></entry>

            <entry>true</entry>

            <entry>If "true" is set, spellchecker returns only the suggest
            words that are as frequent or more frequent than the checked word.
            If "false" set, spellchecker returns null (if checked word exit
            in dictionary), or spellchecker will return the most close suggested
            word.</entry>

          </row>

          <row>
            <entry><parameter>spellchecker-min-distance</parameter></entry>

            <entry>0.55f</entry>

            <entry>Minimal distance between checked word and the proposed suggested word.</entry>

          </row>

          <row>
            <entry><parameter>errorlog-size</parameter></entry>

            <entry>50(Kb)</entry>

            <entry>The default size of error log file in Kb.</entry>

          </row>

          <row>
            <entry><parameter>upgrade-index</parameter></entry>

            <entry>false</entry>

            <entry>Allow JCR to convert an existing index into the new
            format. You have to run an
            automatic migration: Start JCR with <parameter>-Dupgrade-index=true</parameter>. The old
            index format is then converted in the new index format. After the
            conversion, the new format is used. On the next start, you do not
            need this option anymore. As the old index is replaced and a back
            conversion is not possible, you should take a backup of the
            index before.</entry>

          </row>

          <row>
            <entry><parameter>analyzer</parameter></entry>

            <entry>org.apache.lucene.analysis.standard.StandardAnalyzer</entry>

            <entry>Class name of a lucene analyzer to use for fulltext indexing of text.</entry>
          </row>
        </tbody>
      </tgroup>
    </table>

<!-- 2.2.1.1 Global search index -->
  <xi:include href="SearchConfiguration/GlobalSearch.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />

<!-- 2.2.1.2 Indexing tuning -->
<xi:include href="SearchConfiguration/IndexingAdjustments.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />

</section>
