<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<section id="JCR.NodeTypes" role="NotInToc">
  <title>Node types</title>
	<note>
		<para>Support of node types is required by the <ulink
		url="http://www.jcp.org/en/jsr/detail?id=170">JSR-170</ulink> specification. Beyond the methods required by the specification, eXo JCR
		has its own API extension for the <link
		linkend="JCR.NodeTypeRegistration">Node type registration</link> as well
		as the ability to declaratively define node types in the Repository at the
		start-up time.</para>
	</note>
	<para>Node type registration extension is declared in the 
    <parameter>org.exoplatform.services.jcr.core.nodetype.ExtendedNodeTypeManager</parameter> interface.</para>

    <para>Your custom service can register some neccessary predefined node
    types at the start-up time. The node definition should be placed in a
    special XML file (see DTD below) and declared in the service's
    configuration file thanks to eXo component plugin mechanism, described as
    follows:</para>

<programlisting language="xml">&lt;external-component-plugins&gt;
	&lt;target-component&gt;org.exoplatform.services.jcr.RepositoryService&lt;/target-component&gt;
		&lt;component-plugin&gt;
			&lt;name&gt;add.nodeType&lt;/name&gt;
			&lt;set-method&gt;addPlugin&lt;/set-method&gt;
			&lt;type&gt;org.exoplatform.services.jcr.impl.AddNodeTypePlugin&lt;/type&gt;
			&lt;init-params&gt;
				&lt;values-param&gt;
					&lt;name&gt;autoCreatedInNewRepository&lt;/name&gt;
					&lt;description&gt;Node types configuration file&lt;/description&gt;
					&lt;value&gt;jar:/conf/test/nodetypes-tck.xml&lt;/value&gt;
					&lt;value&gt;jar:/conf/test/nodetypes-impl.xml&lt;/value&gt;
				&lt;/values-param&gt;
				&lt;values-param&gt;
					&lt;name&gt;repo1&lt;/name&gt;
					&lt;description&gt;Node types configuration file for repository with name repo1&lt;/description&gt;
					&lt;value&gt;jar:/conf/test/nodetypes-test.xml&lt;/value&gt;
				&lt;/values-param&gt;
				&lt;values-param&gt;
					&lt;name&gt;repo2&lt;/name&gt;
					&lt;description&gt;Node types configuration file for repository with name repo2&lt;/description&gt;
					&lt;value&gt;jar:/conf/test/nodetypes-test2.xml&lt;/value&gt;
				&lt;/values-param&gt;
			&lt;/init-params&gt;
		&lt;/component-plugin&gt;</programlisting>

    <para>There are two types of registration. The first type is the
    registration of node types in all created repositories, it is configured
    in values-param with the name <emphasis
    role="bold">autoCreatedInNewRepository</emphasis>. The second type is
    registration of node types in specified repository and it is configured in
    values-param with the name of repository.</para>
   <xi:include href="nodetype/nodetype-definition.xml"
              xmlns:xi="http://www.w3.org/2001/XInclude" />

   <xi:include href="nodetype/nodetype-registration.xml"
              xmlns:xi="http://www.w3.org/2001/XInclude" />
</section>
